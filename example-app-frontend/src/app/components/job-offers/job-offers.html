<div class="job-offers-container">
  <!-- Header -->
  <div class="header">
    <h1>ğŸš€ Offres d'Emploi & Stages</h1>
    <p>Trouvez l'opportunitÃ© qui vous correspond et postulez directement !</p>
  </div>

  <!-- Filtres -->
  <div class="filters-section">
    <div class="filters-row">
      <!-- Recherche -->
      <div class="filter-group">
        <label>ğŸ” Rechercher</label>
        <input
          type="text"
          [(ngModel)]="searchTerm"
          (input)="onFilterChange()"
          placeholder="Titre, entreprise, description..."
          class="search-input">
      </div>

      <!-- Type d'offre -->
      <div class="filter-group">
        <label>ğŸ“‹ Type</label>
        <select [(ngModel)]="selectedType" (change)="onFilterChange()" class="filter-select">
          <option value="all">Tous</option>
          <option value="emploi">Emploi</option>
          <option value="stage">Stage</option>
        </select>
      </div>

      <!-- Localisation -->
      <div class="filter-group">
        <label>ğŸ“ Localisation</label>
        <input
          type="text"
          [(ngModel)]="selectedLocation"
          (input)="onFilterChange()"
          placeholder="Ville, rÃ©gion..."
          class="filter-input">
      </div>

      <!-- Niveau d'expÃ©rience -->
      <div class="filter-group">
        <label>ğŸ¯ ExpÃ©rience</label>
        <select [(ngModel)]="selectedExperience" (change)="onFilterChange()" class="filter-select">
          <option value="all">Tous niveaux</option>
          <option value="junior">DÃ©butant</option>
          <option value="intermediate">IntermÃ©diaire</option>
          <option value="senior">Senior</option>
          <option value="expert">Expert</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading avec message dynamique -->
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <p>{{ loadingMessage }}</p>
    <small>â±ï¸ Optimisation en cours... Merci de patienter</small>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="error">
    <p>âŒ {{ error }}</p>
    <button (click)="loadJobOffers()" class="retry-btn">RÃ©essayer</button>
  </div>

  <!-- RÃ©sultats -->
  <div *ngIf="!loading && !error" class="results-section">
    <div class="results-header">
      <h2>{{ filteredOffers.length }} offre(s) trouvÃ©e(s)</h2>
    </div>

    <!-- Liste des offres -->
    <div class="offers-grid">
      <div *ngFor="let offer of filteredOffers" class="offer-card">
        <!-- Header de la carte -->
        <div class="offer-header">
          <div class="offer-title-section">
            <h3>{{ offer.title }}</h3>
            <div class="offer-badges">
              <span class="badge" [class]="'badge-' + offer.type">
                {{ offer.type === 'emploi' ? 'ğŸ’¼ Emploi' : 'ğŸ“ Stage' }}
              </span>
              <span class="badge badge-contract">{{ getContractTypeLabel(offer.contract_type) }}</span>
              <span class="badge badge-experience">{{ getExperienceLevelLabel(offer.experience_level) }}</span>
            </div>
          </div>
          <div class="company-info">
            <h4>ğŸ¢ {{ offer.company_name }}</h4>
            <p>ğŸ“ {{ offer.location }}</p>
          </div>
        </div>

        <!-- Description -->
        <div class="offer-description">
          <p>{{ offer.description | slice:0:200 }}{{ offer.description.length > 200 ? '...' : '' }}</p>
        </div>

        <!-- DÃ©tails -->
        <div class="offer-details">
          <div class="detail-item" *ngIf="offer.salary_range">
            <strong>ğŸ’° Salaire:</strong> {{ offer.salary_range }}
          </div>
          <div class="detail-item">
            <strong>ğŸ‘¥ Postes:</strong> {{ offer.positions_available }}
          </div>
          <div class="detail-item" *ngIf="offer.application_deadline">
            <strong>ğŸ“… Date limite:</strong>
            <span [class]="isDeadlineApproaching(offer.application_deadline) ? 'deadline-warning' : ''">
              {{ offer.application_deadline | date:'dd/MM/yyyy' }}
            </span>
            <span *ngIf="isDeadlineApproaching(offer.application_deadline)" class="urgent">âš ï¸ Urgent</span>
          </div>
        </div>

        <!-- CompÃ©tences -->
        <div class="skills-section" *ngIf="offer.skills_required && offer.skills_required.length > 0">
          <strong>ğŸ¯ CompÃ©tences:</strong>
          <div class="skills-tags">
            <span *ngFor="let skill of offer.skills_required" class="skill-tag">{{ skill }}</span>
          </div>
        </div>

        <!-- Actions -->
        <div class="offer-actions">
          <button (click)="viewJobDetails(offer)" class="btn btn-secondary">
            ğŸ‘ï¸ Voir dÃ©tails
          </button>
          <button (click)="applyToJob(offer)" class="btn btn-primary">
            ğŸ“¤ Postuler
          </button>
        </div>
      </div>
    </div>

    <!-- Aucun rÃ©sultat -->
    <div *ngIf="filteredOffers.length === 0" class="no-results">
      <div class="no-results-content">
        <h3>ğŸ” Aucune offre trouvÃ©e</h3>
        <p>Essayez de modifier vos critÃ¨res de recherche.</p>
        <button (click)="selectedType = 'all'; selectedLocation = ''; selectedExperience = 'all'; searchTerm = ''; onFilterChange()"
                class="btn btn-secondary">
          ğŸ”„ RÃ©initialiser les filtres
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal pour les dÃ©tails de l'offre -->
<div *ngIf="showModal" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()" *ngIf="selectedJobOffer">

    <!-- Header du modal -->
    <div class="modal-header">
      <div class="modal-title-section">
        <h2>{{ selectedJobOffer.title }}</h2>
        <div class="modal-badges">
          <span class="badge" [class]="'badge-' + selectedJobOffer.type">
            {{ selectedJobOffer.type === 'emploi' ? 'ğŸ’¼ Emploi' : 'ğŸ“ Stage' }}
          </span>
          <span class="badge badge-contract">{{ getContractTypeLabel(selectedJobOffer.contract_type) }}</span>
          <span class="badge badge-experience">{{ getExperienceLevelLabel(selectedJobOffer.experience_level) }}</span>
        </div>
      </div>
      <button class="modal-close" (click)="closeModal()">
        <span>âœ•</span>
      </button>
    </div>

    <!-- Contenu du modal -->
    <div class="modal-body">

      <!-- Informations entreprise -->
      <div class="modal-section">
        <h3>ğŸ¢ Entreprise</h3>
        <div class="company-details">
          <p><strong>Nom:</strong> {{ selectedJobOffer.company_name }}</p>
          <p><strong>Localisation:</strong> {{ selectedJobOffer.location }}</p>
        </div>
      </div>

      <!-- Description complÃ¨te -->
      <div class="modal-section">
        <h3>ğŸ“ Description du poste</h3>
        <div class="description-content">
          <p>{{ selectedJobOffer.description }}</p>
        </div>
      </div>

      <!-- DÃ©tails du poste -->
      <div class="modal-section">
        <h3>ğŸ’¼ DÃ©tails du poste</h3>
        <div class="details-grid">
          <div class="detail-item">
            <strong>ğŸ¯ Niveau d'expÃ©rience:</strong>
            <span>{{ getExperienceLevelLabel(selectedJobOffer.experience_level) }}</span>
          </div>
          <div class="detail-item">
            <strong>ğŸ“‹ Type de contrat:</strong>
            <span>{{ getContractTypeLabel(selectedJobOffer.contract_type) }}</span>
          </div>
          <div class="detail-item" *ngIf="selectedJobOffer.salary_range">
            <strong>ğŸ’° RÃ©munÃ©ration:</strong>
            <span>{{ selectedJobOffer.salary_range }}</span>
          </div>
          <div class="detail-item" *ngIf="selectedJobOffer.positions_available">
            <strong>ğŸ‘¥ Postes disponibles:</strong>
            <span>{{ selectedJobOffer.positions_available }}</span>
          </div>
          <div class="detail-item" *ngIf="selectedJobOffer.application_deadline">
            <strong>ğŸ“… Date limite:</strong>
            <span [class]="isDeadlineApproaching(selectedJobOffer.application_deadline) ? 'deadline-warning' : ''">
              {{ selectedJobOffer.application_deadline | date:'dd/MM/yyyy' }}
            </span>
            <span *ngIf="isDeadlineApproaching(selectedJobOffer.application_deadline)" class="urgent">âš ï¸ Urgent</span>
          </div>
        </div>
      </div>

      <!-- CompÃ©tences requises -->
      <div class="modal-section" *ngIf="selectedJobOffer.skills_required && selectedJobOffer.skills_required.length > 0">
        <h3>ğŸ¯ CompÃ©tences requises</h3>
        <div class="skills-tags">
          <span *ngFor="let skill of selectedJobOffer.skills_required" class="skill-tag">{{ skill }}</span>
        </div>
      </div>

    </div>

    <!-- Footer du modal -->
    <div class="modal-footer">
      <button (click)="closeModal()" class="btn btn-secondary">
        âŒ Fermer
      </button>
      <button (click)="applyFromModal()" class="btn btn-primary">
        ğŸ“¤ Postuler maintenant
      </button>
    </div>

  </div>
</div>
